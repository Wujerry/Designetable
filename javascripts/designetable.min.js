'use strict';var _Mathmax=Math.max,_Mathmin=Math.min,_Mathabs=Math.abs,_slicedToArray=function(){function c(d,f){var g=[],h=!0,k=!1,l=void 0;try{for(var o,m=d[Symbol.iterator]();!(h=(o=m.next()).done)&&(g.push(o.value),!(f&&g.length===f));h=!0);}catch(s){k=!0,l=s}finally{try{!h&&m['return']&&m['return']()}finally{if(k)throw l}}return g}return function(d,f){if(Array.isArray(d))return d;if(Symbol.iterator in Object(d))return c(d,f);throw new TypeError('Invalid attempt to destructure non-iterable instance')}}(),_createClass=function(){function c(d,f){for(var h,g=0;g<f.length;g++)h=f[g],h.enumerable=h.enumerable||!1,h.configurable=!0,'value'in h&&(h.writable=!0),Object.defineProperty(d,h.key,h)}return function(d,f,g){return f&&c(d.prototype,f),g&&c(d,g),d}}();function _classCallCheck(c,d){if(!(c instanceof d))throw new TypeError('Cannot call a class as a function')}var q=document.querySelectorAll.bind(document),qe=document.querySelector.bind(document),assign=Object.assign,SelectedTD='selected',SelectedTDSeletor='.'+SelectedTD,Designetable=function(){function c(d,f){var g=f.rows,h=void 0===g?5:g,k=f.columns,l=void 0===k?5:k,m=f.data,o=void 0===m?[]:m,s=f.renderTo,u=void 0===s?'body':s,v=f.cssNameSpace,w=void 0===v?'designetable':v;_classCallCheck(this,c),this.id=new Date().getTime()+Math.floor(1e3*Math.random()),this.version='0.0.1',this.cssNameSpace=w,this.selector=d,this.rows=h,this.columns=l,this.data=o,this.container=qe(u),this.element=qe(d),this.contextMenu=null,this.startX=0,this.endX=0,this.startY=0,this.endY=0,this._mergedCell=[],this.selector&&qe(this.selector)?this._refresh():this._init()}return _createClass(c,[{key:'_refresh',value:function _refresh(){}},{key:'_init',value:function _init(){this.element=this._createTable(),this._bindEvent(),this.container&&this.container.appendChild(this.element)}},{key:'_bindEvent',value:function _bindEvent(){this._bindSelection(),this._bindContextMenu(),this._bindDragSize()}},{key:'_bindDragSize',value:function _bindDragSize(){var d=this,f=void 0,g=void 0,h=void 0,k=void 0,l=void 0,m=void 0,o=void 0,s=void 0,u=void 0,v=function appendLine(C,D,E){var F=document.createElement('div'),G=document.createElement('div');return F.classList.add('dt-line-'+D),G.classList.add('dt-line-'+D+'-origin'),'v'===D?(F.style.left=C.clientX-E.left+'px',G.style.left=C.clientX-E.left+'px'):(F.style.top=C.clientY-E.top+'px',G.style.top=C.clientY-E.top+'px'),d.element.appendChild(F),d.element.appendChild(G),[F,G]},w=function changeEffect(){if('v'===k)for(var C=m+(parseInt(g.style.left)-parseInt(l.style.left))+'px',D=f.parentElement.cellIndex,E=0,F=d.element.rows.length;E<F;E++)d.element.rows[E].cells[D].style.width=C;else for(var C=o+(parseInt(g.style.top)-parseInt(l.style.top))+'px',D=f.parentElement.parentElement,E=0,F=D.cells.length;E<F;E++)D.cells[E].style.height=C},z=function mouseMove(C){'v'===k?s<C.clientX||s-C.clientX<m?g.style.left=C.clientX-h.left+'px':g.style.left=s-m-h.left+1+'px':u<C.clientY||u-C.clientY<o?g.style.top=C.clientY-h.top+'px':g.style.top=u-o-h.top+1+'px'},A=function mouseUp(C){d.element.removeEventListener('mousemove',z,!1),document.removeEventListener('mouseup',A,!1),w(C),g.remove(),l.remove()};this.element.addEventListener('mousedown',function mouseDown(C){if('SPAN'===C.target.tagName){f=C.target,h=d.element.getBoundingClientRect(),f.classList.contains('v')&&0===C.button?(k='v',s=C.clientX,m=parseInt(d.getComputedStyle(f.parentElement,'width'))):f.classList.contains('h')&&(k='h',u=C.clientY,o=parseInt(d.getComputedStyle(f.parentElement,'height')));var D=v(C,k,h);g=D[0],l=D[1],d.element.addEventListener('mousemove',z),document.addEventListener('mouseup',A)}})}},{key:'_bindContextMenu',value:function _bindContextMenu(){var h,k,l,m,o,s,u,d=this,f=d.element,g=d._getContextMenuConfig(),v=function clickInsideElement(C,D){var E=C.srcElement||C.target;if(E.classList.contains(D))return E;for(;E=E.parentNode;)if(E.classList&&E.classList.contains(D))return E;return!1},z=function positionMenu(C){var D=d.contextMenu;h=d.getPosition(C),k=h.x,l=h.y,m=D.offsetWidth+2,o=D.offsetHeight+2,s=window.innerWidth,u=window.innerHeight,D.style.left=s-k<m?s-m+'px':k+'px',D.style.top=u-l<o?u-o+'px':l+'px'},A=document.createElement('ul');A.id=d.id+'cm',A.classList.add('dt-context-menu'),A.innerHTML=function createTemplate(){var C=0;return g.reduce(function(D,E){var F='';if(E.children){var G=0;F='<ul class="child-ul">'+E.children.reduce(function(H,I){return H+('<li data-i="'+C+'" data-id="'+(E.id||'')+'" data-ic="'+G++ +'">'+I.name+'</li>')},'')+'</ul>'}return D+('<li data-i="'+C++ +'" data-id="'+(E.id||'')+'" class="context-li">'+E.name+F+'</li>')},'')}(),document.body.appendChild(A),d.contextMenu=A;f.addEventListener('contextmenu',function contextMenuListener(C){C.preventDefault(),z(C),d._toggleContextMenu(!0)}),document.addEventListener('mousedown',function(C){v(C,'context-li')||d._toggleContextMenu(!1)}),A.addEventListener('click',function(C){var D=C.target;if('LI'===D.tagName){var E=D.dataset.i,F=D.dataset.ic;d._toggleContextMenu(!1),F?g[E].children[F].fn&&g[E].children[F].fn(C):g[E].fn&&g[E].fn(C)}})}},{key:'_bindSelection',value:function _bindSelection(){var d=this,f=this,g=f.element,h=[],k=function sameSign(A,B){return-1<(A^B)},l=function transCoordinate(A,B){return[B[0]-A[0],A[1]-B[1]]},m=function reserveCoordinate(A,B){return[A[0]+B[0],A[1]-B[1]]},o=function getPoint(A,B,C){return 1<C.colSpan&&A>=f.startX&&(A=A+C.colSpan-1),1<C.rowSpan&&B>=f.startY&&(B=B+C.rowSpan-1),[A,B]},s=function addOne(A){return-1<A?++A:--A},u=function renderPath(A,B){var C=[f.startX,f.startY],D=h[h.length-1],E=l(C,D),F=[A,B],G=l(C,F),H=function removeRow(){f.removeSelectedClassByPoint(D,m(C,[0,s(G[1])]))},I=function removeColumn(){f.removeSelectedClassByPoint(m(C,[s(G[0]),G[1]]),m(C,[E[0],0]))};if(h.push(F),k(E[0],F[0])&&k(E[1],G[1])){var J=E.map(function(L){return _Mathabs(L)}),K=G.map(function(L){return _Mathabs(L)});K[0]>=J[0]&&K[1]>=J[1]?f.addSelectedClassByPoint(C,F):K[0]<=J[0]&&K[1]<=J[1]?E[0]===G[0]?H():E[1]===G[1]?I():(H(),I()):K[1]<J[1]?(H(),f.addSelectedClassByPoint(F,m(C,[s(E[0]),0]))):(f.removeSelectedClassByPoint(D,m(C,[s(G[0]),0])),f.addSelectedClassByPoint(F,m(C,[0,s(E[1])])))}else f.clearSelected(),f.addSelectedClassByPoint(C,F)},v=function mouseMove(A){if('TD'===A.target.tagName){A.preventDefault();var B=A.target,C=h[h.length-1],D=B.cellIndex,E=B.parentElement.rowIndex;if(C[0]!==D||C[1]!==E){var F=o(D,E,B);f.endX=F[0],f.endY=F[1],u(F[0],F[1])}}},w=function mouseUp(){g.removeEventListener('mousemove',v,!1),document.removeEventListener('mouseup',w)};g.addEventListener('mousedown',function mousedown(A){if('TD'===A.target.tagName&&0===A.button){d.clearSelected(),d.clearStart();var B=A.target;f.startX=f.endX=B.cellIndex,f.startY=f.endY=B.parentElement.rowIndex,h.length=0,h.push([f.startX,f.startY]),f.addSelectedClass(B),B.classList.add('start'),g.addEventListener('mousemove',v),document.addEventListener('mouseup',w)}})}},{key:'_createTable',value:function _createTable(){var d=document.createElement('table');return d.classList.add(this.cssNameSpace),this.data.length||(d.innerHTML=this._createRows(this.columns,this.rows).join('')),d}},{key:'_createEls',value:function _createEls(){var d=0<arguments.length&&void 0!==arguments[0]?arguments[0]:'td',f=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1;return Array(f).fill(0).map(function(){return'<'+d+'><span class="v"></span><span class="h"></span></'+d+'>'})}},{key:'_createRows',value:function _createRows(d){var f=this,g=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1;return Array(g).fill(0).map(function(){return'<tr>'+f._createEls('td',d).join('')+'</tr>'})}},{key:'_calPoint',value:function _calPoint(d,f){return[[_Mathmin(d[0],f[0]),_Mathmin(d[1],f[1])],[_Mathmax(d[0],f[0]),_Mathmax(d[1],f[1])]]}},{key:'_handleSelectedClassByPoint',value:function _handleSelectedClassByPoint(d,f,g){for(var h={add:'addSelectedClass',remove:'removeSelectedClass'},k=this._calPoint(f,g),l=_slicedToArray(k,2),m=l[0],o=l[1],s=m[1],u=o[1]+1;s<u;s++)for(var v=m[0],w=o[0]+1;v<w;v++)this[h[d]](this.getTdByPoint(v,s))}},{key:'_toggleContextMenu',value:function _toggleContextMenu(d){this.contextMenu&&(d&&this._BeforeContextMenu(),this.contextMenu.classList.toggle('show',d))}},{key:'_BeforeContextMenu',value:function _BeforeContextMenu(){this._isMergedCellInsideSelection()?(this.contextMenu.querySelector('[data-id=mc]').style.display='block',this.contextMenu.querySelector('[data-id=umc]').style.display='none'):(this.contextMenu.querySelector('[data-id=mc]').style.display='none',this.contextMenu.querySelector('[data-id=umc]').style.display='block')}},{key:'_getContextMenuConfig',value:function _getContextMenuConfig(){var d=this;return[{name:'Merge cells',id:'mc',icon:'copy',fn:function fn(f){d.mergeCells(f)}},{name:'UnMerge cells',id:'umc',icon:'copy',fn:function fn(f){d.unMergeCells(f)}},{name:'Copy',icon:'copy'},{name:'Paste',icon:'paste'},{name:'Parent',icon:'parent',children:[{name:'child'}]}]}},{key:'_isMergedCellInsideSelection',value:function _isMergedCellInsideSelection(){var d=this;return this._mergedCell.length,this._mergedCell.every(function(f){return!d._isCellInSelection(f)})}},{key:'_isCellInSelection',value:function _isCellInSelection(d){return d[0]>=this.startX&&d[0]<=this.endX&&d[1]>=this.startY&&d[1]<=this.endY}},{key:'getComputedStyle',value:function getComputedStyle(d,f){return window.getComputedStyle(d,null).getPropertyValue(f)}},{key:'unMergeCells',value:function unMergeCells(){var d=this,f=[];this._mergedCell.filter(function(g){return!!d._isCellInSelection(g)||(f.push(g),!1)}).forEach(function(g){for(var h=d.getTdByPoint(g[0],g[1]),k=g[1],l=k+h.rowSpan;k<l;k++)for(var m=g[0],o=m+h.colSpan;m<o;m++)d.getTdByPoint(m,k).style.display='table-cell';h.rowSpan=h.colSpan=1}),this._mergedCell=f}},{key:'mergeCells',value:function mergeCells(){if(this._isMergedCellInsideSelection()&&!this.isEqualPoint()){var d=this._calPoint([this.startX,this.startY],[this.endX,this.endY]),f=_slicedToArray(d,2),g=f[0],h=f[1],k=this.getTdByPoint(g[0],g[1]);k.colSpan=h[0]-g[0]+1,k.rowSpan=h[1]-g[1]+1;for(var l=g[1],m=h[1];l<=m;l++)for(var o=g[0],s=h[0];o<=s;o++)this.getTdByPoint(o,l).style.display='none';k.style.display='table-cell',this._mergedCell.push([g[0],g[1]])}}},{key:'isEqualPoint',value:function isEqualPoint(d,f){return d&&f?d[0]===f[0]&&d[1]===f[1]:this.startX===this.endX&&this.startY===this.endY}},{key:'getPosition',value:function getPosition(d){var f=0,g=0;return d||(d=window.event),d.pageX||d.pageY?(f=d.pageX,g=d.pageY):(d.clientX||d.clientY)&&(f=d.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,g=d.clientY+document.body.scrollTop+document.documentElement.scrollTop),{x:f,y:g}}},{key:'addSelectedClassByPoint',value:function addSelectedClassByPoint(d,f){this._handleSelectedClassByPoint('add',d,f)}},{key:'removeSelectedClass',value:function removeSelectedClass(d){d.classList.remove(SelectedTD)}},{key:'removeSelectedClassByPoint',value:function removeSelectedClassByPoint(d,f){this._handleSelectedClassByPoint('remove',d,f)}},{key:'clearSelected',value:function clearSelected(){this.element.querySelectorAll(SelectedTDSeletor).forEach(function(d){return d.classList.remove(SelectedTD)})}},{key:'clearStart',value:function clearStart(){this.element.querySelectorAll('.start').forEach(function(d){return d.classList.remove('start')})}},{key:'getTdByPoint',value:function getTdByPoint(d,f){return this.element.rows[f]?this.element.rows[f].cells[d]:this.element}},{key:'addSelectedClass',value:function addSelectedClass(d){d.classList.add(SelectedTD)}},{key:'destroy',value:function destroy(){document.querySelectorAll('.dt-context-menu').forEach(function(d){return d.remove()})}},{key:'logOption',value:function logOption(){console.log(this.options)}},{key:'version',value:function version(){console.log(this.version)}}]),c}();
//# sourceMappingURL=designetable.js.map
